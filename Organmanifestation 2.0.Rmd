---
title: "Organmanifestatiion 2.0"
author: "David Nikue"
date: "2023-12-10"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(tidyverse)
library(patchwork)
```


```{r}
Daten <- read.csv("Daten.csv")
```

```{r}
#Kategorie der Anzahl der Raynaud Attacken der letzten vier Wochen umbennenen
 
kategorisiere_attacken_neu <- function(Anzahl.Raynaud.Attacken) {
  ifelse(Anzahl.Raynaud.Attacken == "0", "0",
    ifelse(Anzahl.Raynaud.Attacken == "<5", "1-4",
      ifelse(Anzahl.Raynaud.Attacken == "<10", "5-9",
        ifelse(Anzahl.Raynaud.Attacken == ">10", "10-15",
          ifelse(Anzahl.Raynaud.Attacken == ">15", "16-20",
            ifelse(Anzahl.Raynaud.Attacken == ">20", "21+", NA))))))

}
  
  
Daten$Anzahl.Raynaud.Attacken <- sapply(Daten$Anzahl.Raynaud.Attacken, kategorisiere_attacken_neu)

```


```{r}
#Die Daten der Spalten der Organmanifestationen umändern

Daten$sek..Organmanifestation <- factor(Daten$sek..Organmanifestation, levels = c("0", "1"),labels = c("Manifestation ja", "Manifestation nein"))
Daten$Lok_Herz <- factor(Daten$Lok_Herz, levels = c("0", "1"),labels = c("Manifestation ja", "Manifestation nein"))
Daten$Lok_Lunge <- factor(Daten$Lok_Lunge, levels = c("0", "1"),labels = c("Manifestation ja", "Manifestation nein"))
Daten$Lok_Bewegungsapparat <- factor(Daten$Lok_Bewegungsapparat, levels = c("0", "1"),labels = c("Manifestation ja", "Manifestation nein"))
Daten$Lok_Ösophagus <- factor(Daten$Lok_Ösophagus, levels = c("0", "1"),labels = c("Manifestation ja", "Manifestation nein"))
```


```{r}
#Farben für die plots

Farben_Risiko <- c("Manifestation ja" = "chartreuse4", "Manifestation nein" = "darkmagenta")
```




```{r}
#Allgemeine sekundäre plot


sek2_plot <- Daten %>%
  group_by(Anzahl.Raynaud.Attacken, sek..Organmanifestation) %>%
  summarise(anzahl = n(), .groups = "drop_last") %>%
  mutate(rel_haeufigkeit = anzahl / sum(anzahl)) %>%na.omit() %>%
  ggplot(aes(x = factor(Anzahl.Raynaud.Attacken, levels = c("0", "1-4", "5-9", "10-15","16-20","21+")), y = rel_haeufigkeit, fill = sek..Organmanifestation)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Anzahl der Raynaud Attacken", y = "Relative Häufigkeiten") +
  theme_bw() + scale_fill_manual(values = Farben_Risiko, name = "sek. Organmanifestation")

sek2_plot

```


```{r}
ggsave("sek2.pdf", sek2_plot, width = 40, height = 20, units = "cm")
```



```{r}
#Plot für die Lokalisation am Herzen



herz2_plot <- Daten %>%
  group_by(Anzahl.Raynaud.Attacken, Lok_Herz) %>%
  summarise(anzahl = n(), .groups = "drop_last") %>%
  mutate(rel_haeufigkeit = anzahl / sum(anzahl)) %>%na.omit() %>%
  ggplot(aes(x = factor(Anzahl.Raynaud.Attacken, levels = c("0", "1-4", "5-9", "10-15","16-20","21+")), y = rel_haeufigkeit, fill = Lok_Herz)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Anzahl der Raynaud Attacken", y = "Relative Häufigkeiten") +
  theme_bw() + scale_fill_manual(values = Farben_Risiko, name = "Lokalisation Herz")


herz2_plot

```





```{r}
#Hier werden die Reihe 12 und 13 entfernt, da sie bei der Spalte "Lok_Lunge" nur NA besitzen.

Daten_Lunge <-  Daten[!(row.names(Daten) %in% c("12","13")),]
```


```{r}
#Plot für die Lokalisation an der Lunge

lunge2_plot <- Daten_Lunge %>%
  group_by(Anzahl.Raynaud.Attacken, Lok_Lunge) %>%
  summarise(anzahl = n(), .groups = "drop_last") %>%
  mutate(rel_haeufigkeit = anzahl / sum(anzahl)) %>%na.omit() %>%
  ggplot(aes(x = factor(Anzahl.Raynaud.Attacken, levels = c("0", "1-4", "5-9", "10-15","16-20","21+")), y = rel_haeufigkeit, fill = Lok_Lunge)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Anzahl der Raynaud Attacken", y = "Relative Häufigkeiten") +
  theme_bw() + scale_fill_manual(values = Farben_Risiko, name = "Lokalisation Lunge")

lunge2_plot
```




```{r}
#Plot für die Lokalisation des Bewegungsapparats

bewegung2_plot <- Daten %>%
  group_by(Anzahl.Raynaud.Attacken, Lok_Bewegungsapparat) %>%
  summarise(anzahl = n(), .groups = "drop_last") %>%
  mutate(rel_haeufigkeit = anzahl / sum(anzahl)) %>%na.omit() %>%
  ggplot(aes(x = factor(Anzahl.Raynaud.Attacken, levels = c("0", "1-4", "5-9", "10-15","16-20","21+")), y = rel_haeufigkeit, fill = Lok_Bewegungsapparat)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Anzahl der Raynaud Attacken", y = "Relative Häufigkeiten") +
  theme_bw() + scale_fill_manual(values = Farben_Risiko, name = "Lokalisation Bewegungsapparat")



bewegung2_plot
```


```{r}
#Plot für die Lokalisation des Ösophagus

oesophagus2_plot <- Daten %>%
  group_by(Anzahl.Raynaud.Attacken, Lok_Ösophagus) %>%
  summarise(anzahl = n(), .groups = "drop_last") %>%
  mutate(rel_haeufigkeit = anzahl / sum(anzahl)) %>%na.omit() %>%
  ggplot(aes(x = factor(Anzahl.Raynaud.Attacken, levels = c("0", "1-4", "5-9", "10-15","16-20","21+")), y = rel_haeufigkeit, fill = Lok_Ösophagus)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(x = "Anzahl der Raynaud Attacken", y = "Relative Häufigkeiten") +
  theme_bw() + scale_fill_manual(values = Farben_Risiko, name = "Lokalisation Oesophagus")


oesophagus2_plot

```



```{r}
#Herz und Lunge in einer gemeinsamen Grafik

herz_lunge_plot <- (lunge2_plot | herz2_plot)




herz_lunge_plot

ggsave("herzlunge2.pdf", herz_lunge_plot, width = 40 , height = 20, units = "cm")
```



```{r}
#Ösophagus und Bewegungsapparat in einer gemeinsamen Grafik

oeso_bewegung_plot <-(oesophagus2_plot | bewegung2_plot)


oeso_bewegung_plot


ggsave("oeso_bewegung3.pdf", oeso_bewegung_plot, width = 40 , height = 20, units = "cm")
```

